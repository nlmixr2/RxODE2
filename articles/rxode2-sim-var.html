<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rxode2">
<title>rxode2 Simulation • rxode2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="rxode2 Simulation">
<meta property="og:description" content="rxode2">
<meta property="og:image" content="https://nlmixr2.github.io/rxode2/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><meta name="google-site-verification" content="fp9A3qPrCar1DKeVQg4Mfrf6-An5keP9OwhIxUkntbU">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rxode2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--articles">
    <span class="fas fa fas fa-book"></span>
     
    Articles
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--articles">
    <h6 class="dropdown-header" data-toc-skip>Getting started</h6>
    <a class="dropdown-item" href="../articles/rxode2-syntax.html">rxode2 mini language syntax</a>
    <a class="dropdown-item" href="../articles/Modifying-Models.html">rxode2 model modification %&gt;%</a>
    <a class="dropdown-item" href="../articles/rxode2-pipeline.html">rxode2 pipeline ie %&gt;%</a>
    <a class="dropdown-item" href="../articles/rxode2-speed.html">Speeding up rxode2 ODE solving</a>
    <a class="dropdown-item" href="../articles/rxode2-data-frame.html">Adaptive Data Frames with rxode2</a>
    <a class="dropdown-item" href="../articles/rxode2-plot.html">Plotting with rxode2</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Advanced Features, Model Types, Technical Details</h6>
    <a class="dropdown-item" href="../articles/rxode2-model-types.html">rxode2 model types</a>
    <a class="dropdown-item" href="../articles/rxode2-cmt.html">Chainging rxode2 compartment numbers</a>
    <a class="dropdown-item" href="../articles/rxode2-transit-compartments.html">rxode2 transit compartment models</a>
    <a class="dropdown-item" href="../articles/rxode2-shiny.html">Using Shiny with rxode2</a>
    <a class="dropdown-item" href="../articles/rxode2-covariates.html">rxode2 covariates</a>
    <a class="dropdown-item" href="../articles/rxode2-stiff.html">Stiff Systems and Jacobian specification</a>
    <a class="dropdown-item" href="../articles/rxode2-rxUse.html">Adding compiled rxode2 models to your package</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--dosing-events">
    <span class="fas fa fas fa-stethoscope"></span>
     
    Dosing/Events
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--dosing-events">
    <a class="dropdown-item" href="../articles/rxode2-datasets.html">nlmixr/rxode2 dataset overview</a>
    <a class="dropdown-item" href="../articles/rxode2-event-types.html">Supported Event Types</a>
    <a class="dropdown-item" href="../articles/rxode2-event-table.html">Easy rxode2 Event Tables</a>
    <a class="dropdown-item" href="../articles/rxode2-events-classic.html">Classic rxode2 events explained</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--simulations">
    <span class="fas fa fas fa-desktop"></span>
     
    Simulations
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--simulations">
    <a class="dropdown-item" href="../articles/rxode2-single-subject.html">Single Subject ODE solving</a>
    <a class="dropdown-item" href="../articles/rxode2-sim-var.html">Multiple Subject rxode2 Simulation</a>
    <a class="dropdown-item" href="../articles/rxode2-prior-data.html">Using Prior Data for ODE solving</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--help">
    <span class="fas fa fas fa-life-ring"></span>
     
    Help
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--help">
    <a class="dropdown-item" href="../articles/rxode2-tutorials.html">Running the interactive tutorials</a>
    <a class="external-link dropdown-item" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4728294/pdf/PSP4-5-03.pdf">2015 CPT tutorial</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/rxode2-covariates.html">Adding Circadian Rythmn (time-varying covariates)</a>
    <a class="dropdown-item" href="../articles/rxode2-wt.html">Weight Based Dosing</a>
    <a class="dropdown-item" href="../articles/rxode2-nesting.html">Simulating Multiple levels of nesting (iov, between study etc)</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changes/News</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://nlmixr2.github.io/rxode2/reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--">
    <span class="fas fa fas fa-archive"></span>
     
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--">
    <a class="dropdown-item" href="https://nlmixr2.github.io/rxode2-manual/">rxode2 User Guide</a>
    <a class="external-link dropdown-item" href="https://nlmixr2.org/">nlmixr2</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nlmixr2/rxode2">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nlmixr2/rxode2/releases">
    <span class="fa fa-download"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>rxode2 Simulation</h1>
            
            <h4 data-toc-skip class="date">2024-04-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nlmixr2/rxode2/blob/HEAD/vignettes/rxode2-sim-var.Rmd" class="external-link"><code>vignettes/rxode2-sim-var.Rmd</code></a></small>
      <div class="d-none name"><code>rxode2-sim-var.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="population-simulations-with-rxode2">Population Simulations with rxode2<a class="anchor" aria-label="anchor" href="#population-simulations-with-rxode2"></a>
</h2>
<div class="section level3">
<h3 id="simulation-of-variability-with-rxode2">Simulation of Variability with rxode2<a class="anchor" aria-label="anchor" href="#simulation-of-variability-with-rxode2"></a>
</h3>
<p>In pharmacometrics the nonlinear-mixed effect modeling software (like
nlmixr) characterizes the between-subject variability. With this between
subject variability you can simulate new subjects.</p>
<p>Assuming that you have a 2-compartment, indirect response model, you
can set create an rxode2 model describing this system below:</p>
<div class="section level4">
<h4 id="setting-up-the-rxode2-model">Setting up the rxode2 model<a class="anchor" aria-label="anchor" href="#setting-up-the-rxode2-model"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nlmixr2.github.io/rxode2/">rxode2</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; rxode2 2.1.2.9000 using 2 threads (see ?getRxThreads)</span></span>
<span><span class="co">#&gt;   no cache: create with `rxCreateCache()`</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">32</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://nlmixr2.github.io/rxode2random/reference/rxSetSeed.html">rxSetSeed</a></span><span class="op">(</span><span class="fl">32</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/ini.html">ini</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">KA</span> <span class="op">&lt;-</span> <span class="fl">2.94E-01</span></span>
<span>    <span class="va">TCl</span> <span class="op">&lt;-</span> <span class="fl">1.86E+01</span></span>
<span>    <span class="co"># between subject variability</span></span>
<span>    <span class="va">eta.Cl</span> <span class="op">~</span> <span class="fl">0.4</span><span class="op">^</span><span class="fl">2</span></span>
<span>    <span class="va">V2</span> <span class="op">&lt;-</span> <span class="fl">4.02E+01</span></span>
<span>    <span class="va">Q</span> <span class="op">&lt;-</span> <span class="fl">1.05E+01</span></span>
<span>    <span class="va">V3</span> <span class="op">&lt;-</span> <span class="fl">2.97E+02</span></span>
<span>    <span class="va">Kin</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="va">Kout</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="va">EC50</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/model.html">model</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">C2</span> <span class="op">&lt;-</span> <span class="va">centr</span><span class="op">/</span><span class="va">V2</span></span>
<span>    <span class="va">C3</span> <span class="op">&lt;-</span> <span class="va">peri</span><span class="op">/</span><span class="va">V3</span></span>
<span>    <span class="va">CL</span> <span class="op">&lt;-</span>  <span class="va">TCl</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta.Cl</span><span class="op">)</span> <span class="co">## This is coded as a variable in the model</span></span>
<span>    <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">depot</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">KA</span><span class="op">*</span><span class="va">depot</span></span>
<span>    <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">centr</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">KA</span><span class="op">*</span><span class="va">depot</span> <span class="op">-</span> <span class="va">CL</span><span class="op">*</span><span class="va">C2</span> <span class="op">-</span> <span class="va">Q</span><span class="op">*</span><span class="va">C2</span> <span class="op">+</span> <span class="va">Q</span><span class="op">*</span><span class="va">C3</span></span>
<span>    <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">peri</span><span class="op">)</span>  <span class="op">&lt;-</span>                    <span class="va">Q</span><span class="op">*</span><span class="va">C2</span> <span class="op">-</span> <span class="va">Q</span><span class="op">*</span><span class="va">C3</span></span>
<span>    <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">eff</span><span class="op">)</span>   <span class="op">&lt;-</span> <span class="va">Kin</span> <span class="op">-</span> <span class="va">Kout</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">C2</span><span class="op">/</span><span class="op">(</span><span class="va">EC50</span><span class="op">+</span><span class="va">C2</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">eff</span></span>
<span>    <span class="fu">eff</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="simulating">Simulating<a class="anchor" aria-label="anchor" href="#simulating"></a>
</h4>
<p>The next step to simulate is to create the dosing regimen for overall
simulation:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>amountUnits<span class="op">=</span><span class="st">"mg"</span>, timeUnits<span class="op">=</span><span class="st">"hours"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>amt<span class="op">=</span><span class="fl">10000</span>, cmt<span class="op">=</span><span class="st">"centr"</span><span class="op">)</span></span></code></pre></div>
<p>If you wish, you can also add sampling times (though rxode2 can fill
these in for you):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="va">ev</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">48</span>, length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>Note the <code>et</code> takes similar arguments as <code>seq</code>
when adding sampling times. There are more methods to adding sampling
times and events to make complex dosing regimens (See <a href="rxode2-events.html">the event vignette</a>). This includes ways to
add variability to the <a href="rxode2-events.html#add-doses-and-samples-within-a-sampling-window">both
the sampling and dosing times</a>).</p>
<p>Once this is complete you can simulate using the <code>rxSolve</code>
routine:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">ev</span>, nSub<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0’</span></span></code></pre></div>
<p>To quickly look and customize your simulation you use the default
<code>plot</code> routine. Since this is an rxode2 object, it will
create a <code>ggplot2</code> object that you can modify as you wish.
The extra parameter to the <code>plot</code> tells
<code>rxode2</code>/<code>R</code> what piece of information you are
interested in plotting. In this case, we are interested in looking at
the derived parameter <code>C2</code>:</p>
</div>
<div class="section level4">
<h4 id="checking-the-simulation-with-plot">Checking the simulation with <code>plot</code><a class="anchor" aria-label="anchor" href="#checking-the-simulation-with-plot"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co">## The plots from rxode2 are ggplots so they can be modified with</span></span>
<span><span class="co">## standard ggplot commands.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim</span>, <span class="va">C2</span>, log<span class="op">=</span><span class="st">"y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Central Compartment"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="rxode2-sim-var_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Of course this additional parameter could also be a state value, like
<code>eff</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## They also takes many of the standard plot arguments; See ?plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim</span>, <span class="va">eff</span>, ylab<span class="op">=</span><span class="st">"Effect"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rxode2-sim-var_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Or you could even look at the two side-by-side:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim</span>, <span class="va">C2</span>, <span class="va">eff</span><span class="op">)</span></span></code></pre></div>
<p><img src="rxode2-sim-var_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>Or stack them with <code>patchwork</code></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim</span>, <span class="va">C2</span>, log<span class="op">=</span><span class="st">"y"</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim</span>, <span class="va">eff</span><span class="op">)</span></span></code></pre></div>
<p><img src="rxode2-sim-var_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="processing-the-data-to-create-summary-plots">Processing the data to create summary plots<a class="anchor" aria-label="anchor" href="#processing-the-data-to-create-summary-plots"></a>
</h4>
<p>Usually in pharmacometric simulations it is not enough to simply
simulate the system. We have to do something easier to digest, like look
at the central and extreme tendencies of the simulation.</p>
<p>Since the <code>rxode2</code> solve object is a type of <a href="rxode2-data-frame.html">data frame</a></p>
<p>It is now straightforward to perform calculations and generate plots
with the simulated data. You can</p>
<p>Below, the 5th, 50th, and 95th percentiles of the simulated data are
plotted.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">sim</span>, <span class="st">"C2"</span>, level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>ylab<span class="op">=</span><span class="st">"Central Concentration"</span>, log<span class="op">=</span><span class="st">"y"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> in order to put confidence bands around the intervals, you need at least 2500 simulations</span></span>
<span><span class="co">#&gt; summarizing data...done</span></span></code></pre></div>
<p><img src="rxode2-sim-var_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">sim</span>, <span class="st">"eff"</span>, level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>ylab<span class="op">=</span><span class="st">"Effect"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> in order to put confidence bands around the intervals, you need at least 2500 simulations</span></span>
<span><span class="co">#&gt; summarizing data...done</span></span></code></pre></div>
<p><img src="rxode2-sim-var_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>Note that you can see the parameters that were simulated for the
example</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">param</span><span class="op">)</span></span>
<span><span class="co">#&gt;   sim.id    KA  TCl   V2    Q  V3 Kin Kout EC50     eta.Cl</span></span>
<span><span class="co">#&gt; 1      1 0.294 18.6 40.2 10.5 297   1    1  200  0.8067570</span></span>
<span><span class="co">#&gt; 2      2 0.294 18.6 40.2 10.5 297   1    1  200  0.0236961</span></span>
<span><span class="co">#&gt; 3      3 0.294 18.6 40.2 10.5 297   1    1  200 -0.3340697</span></span>
<span><span class="co">#&gt; 4      4 0.294 18.6 40.2 10.5 297   1    1  200 -0.1098197</span></span>
<span><span class="co">#&gt; 5      5 0.294 18.6 40.2 10.5 297   1    1  200 -0.2803752</span></span>
<span><span class="co">#&gt; 6      6 0.294 18.6 40.2 10.5 297   1    1  200 -0.2114090</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="simulation-of-unexplained-variability-sigma">Simulation of unexplained variability (sigma)<a class="anchor" aria-label="anchor" href="#simulation-of-unexplained-variability-sigma"></a>
</h4>
<p>In addition to conveniently simulating between subject variability,
you can also easily simulate unexplained variability.</p>
<p>One way to do that is to create a rxode2 model with the endpoints
defined. Model piping can do this while keeping the model intact:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="va">mod</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/model.html">model</a></span><span class="op">(</span><span class="va">eff</span> <span class="op">~</span> <span class="fu">add</span><span class="op">(</span><span class="va">eff.sd</span><span class="op">)</span>, append<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/model.html">model</a></span><span class="op">(</span><span class="va">C2</span> <span class="op">~</span> <span class="fu">prop</span><span class="op">(</span><span class="va">prop.sd</span><span class="op">)</span>, append<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ini.html">ini</a></span><span class="op">(</span>eff.sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>, prop.sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> add residual parameter `eff.sd` and set estimate to 1</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> add residual parameter `prop.sd` and set estimate to 1</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `eff.sd` to `0.316227766016838`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `prop.sd` to `0.316227766016838`</span></span></code></pre></div>
<p>You can see how the dataset should be defined with
<code>$multipleEndpoint</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod2</span><span class="op">$</span><span class="va">multipleEndpoint</span></span>
<span><span class="co">#&gt;   variable                cmt                dvid*</span></span>
<span><span class="co">#&gt; 1  eff ~ … cmt='eff' or cmt=4 dvid='eff' or dvid=1</span></span>
<span><span class="co">#&gt; 2   C2 ~ …  cmt='C2' or cmt=5  dvid='C2' or dvid=2</span></span></code></pre></div>
<p>Here you see the endpoints should be defined for <code>eff</code> and
<code>C2</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>amountUnits<span class="op">=</span><span class="st">"mg"</span>, timeUnits<span class="op">=</span><span class="st">"hours"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>amt<span class="op">=</span><span class="fl">10000</span>, cmt<span class="op">=</span><span class="st">"centr"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">48</span>, length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span>, cmt<span class="op">=</span><span class="st">"eff"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">48</span>, length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span>, cmt<span class="op">=</span><span class="st">"C2"</span><span class="op">)</span></span></code></pre></div>
<p>Which allows you to solve the system:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">mod2</span>, <span class="va">ev</span>, nSub<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0’</span></span></code></pre></div>
<p>Since this is simulated from a model with the residual specification
included and a multiple endpoint model, you can summarize for each
endpoint by simply taking a confidence interval of
<code>"sim"</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">sim</span>, <span class="st">"sim"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> in order to put confidence bands around the intervals, you need at least 2500 simulations</span></span>
<span><span class="co">#&gt; summarizing data...done</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></code></pre></div>
<p><img src="rxode2-sim-var_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>If you want to subset to a specific endpoint, like <code>eff</code>
you can create the confidence interval for only that endpoint by using
the specification <code>sim.eff</code>, where the endpoint name is
separated from <code>sim</code> by a dot:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">sim</span>, <span class="st">"sim.eff"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> in order to put confidence bands around the intervals, you need at least 2500 simulations</span></span>
<span><span class="co">#&gt; summarizing data...done</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">seff</span><span class="op">)</span></span></code></pre></div>
<p><img src="rxode2-sim-var_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="simulation-of-individuals">Simulation of Individuals<a class="anchor" aria-label="anchor" href="#simulation-of-individuals"></a>
</h4>
<p>Sometimes you may want to match the dosing and observations of
individuals in a clinical trial. To do this you will have to create a
data.frame using the <code>rxode2</code> event specification as well as
an <code>ID</code> column to indicate an individual. The rxode2 event
vignette talks more about how these datasets should be created.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="va">ev1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>amountUnits<span class="op">=</span><span class="st">"mg"</span>, timeUnits<span class="op">=</span><span class="st">"hours"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>amt<span class="op">=</span><span class="fl">10000</span>, cmt<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">48</span>,length.out<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ev2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>amountUnits<span class="op">=</span><span class="st">"mg"</span>, timeUnits<span class="op">=</span><span class="st">"hours"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>amt<span class="op">=</span><span class="fl">5000</span>, cmt<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">48</span>,length.out<span class="op">=</span><span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>ID<span class="op">=</span><span class="fl">1</span>, <span class="va">ev1</span><span class="op">$</span><span class="fu">get.EventTable</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>ID<span class="op">=</span><span class="fl">2</span>, <span class="va">ev2</span><span class="op">$</span><span class="fu">get.EventTable</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## Note the number of subject is not needed since it is determined by the data</span></span>
<span><span class="va">sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0’</span></span>
<span></span>
<span><span class="va">sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">time</span>, <span class="va">eff</span>, <span class="va">C2</span><span class="op">)</span></span>
<span><span class="co">#&gt;    id          time      eff          C2</span></span>
<span><span class="co">#&gt; 1   1  0.000000 [h] 1.000000 248.7562189</span></span>
<span><span class="co">#&gt; 2   1  5.333333 [h] 1.168348  19.1658271</span></span>
<span><span class="co">#&gt; 3   1 10.666667 [h] 1.040652   7.1764936</span></span>
<span><span class="co">#&gt; 4   1 16.000000 [h] 1.030849   6.0167596</span></span>
<span><span class="co">#&gt; 5   1 21.333333 [h] 1.027742   5.4446478</span></span>
<span><span class="co">#&gt; 6   1 26.666667 [h] 1.025204   4.9484199</span></span>
<span><span class="co">#&gt; 7   1 32.000000 [h] 1.022911   4.4984868</span></span>
<span><span class="co">#&gt; 8   1 37.333333 [h] 1.020828   4.0895169</span></span>
<span><span class="co">#&gt; 9   1 42.666667 [h] 1.018933   3.7177314</span></span>
<span><span class="co">#&gt; 10  1 48.000000 [h] 1.017211   3.3797461</span></span>
<span><span class="co">#&gt; 11  2  0.000000 [h] 1.000000 124.3781095</span></span>
<span><span class="co">#&gt; 12  2  6.857143 [h] 1.016301   1.9290018</span></span>
<span><span class="co">#&gt; 13  2 13.714286 [h] 1.006648   1.2918078</span></span>
<span><span class="co">#&gt; 14  2 20.571429 [h] 1.005617   1.0964981</span></span>
<span><span class="co">#&gt; 15  2 27.428571 [h] 1.004772   0.9317005</span></span>
<span><span class="co">#&gt; 16  2 34.285714 [h] 1.004055   0.7916739</span></span>
<span><span class="co">#&gt; 17  2 41.142857 [h] 1.003446   0.6726918</span></span>
<span><span class="co">#&gt; 18  2 48.000000 [h] 1.002928   0.5715923</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="simulation-of-clinical-trials">Simulation of Clinical Trials<a class="anchor" aria-label="anchor" href="#simulation-of-clinical-trials"></a>
</h2>
<p>By either using a simple single event table, or data from a clinical
trial as described above, a complete clinical trial simulation can be
performed.</p>
<p>Typically in clinical trial simulations you want to account for the
uncertainty in the fixed parameter estimates, and even the uncertainty
in both your between subject variability as well as the unexplained
variability.</p>
<p><code>rxode2</code> allows you to account for these uncertainties by
simulating multiple virtual “studies,” specified by the parameter
<code>nStud</code>. Each of these studies samples a realization of fixed
effect parameters and covariance matrices for the between subject
variability(<code>omega</code>) and unexplained variabilities
(<code>sigma</code>). Depending on the information you have from the
models, there are a few strategies for simulating a realization of the
<code>omega</code> and <code>sigma</code> matrices.</p>
<p>The first strategy occurs when either there is not any standard
errors for standard deviations (or related parameters), or there is a
modeled correlation in the model you are simulating from. In that case
the suggested strategy is to use the inverse Wishart (parameterized to
scale to the conjugate prior)/<a href="https://en.wikipedia.org/wiki/Scaled_inverse_chi-squared_distribution" class="external-link">scaled
inverse chi distribution</a>. this approach uses a single parameter to
inform the variability of the covariance matrix sampled (the degrees of
freedom).</p>
<p>The second strategy occurs if you have standard errors on the
variance/standard deviation with no modeled correlations in the
covariance matrix. In this approach you perform separate simulations for
the standard deviations and the correlation matrix. First you simulate
the variance/standard deviation components in the <code>thetaMat</code>
multivariate normal simulation. After simulation and transformation to
standard deviations, a correlation matrix is simulated using the degrees
of freedom of your covariance matrix. Combining the simulated standard
deviation with the simulated correlation matrix will give a simulated
covariance matrix. For smaller dimension covariance matrices (dimension
&lt; 10x10) it is recommended you use the <code>lkj</code> distribution
to simulate the correlation matrix. For higher dimension covariance
matrices it is suggested you use the inverse wishart distribution
(transformed to a correlation matrix) for the simulations.</p>
<p>The covariance/variance prior is simulated from <code>rxode2</code>s
<code><a href="https://nlmixr2.github.io/rxode2random/reference/cvPost.html">cvPost()</a></code> function.</p>
<div class="section level3">
<h3 id="simulation-from-inverse-wishart-correlations">Simulation from inverse Wishart correlations<a class="anchor" aria-label="anchor" href="#simulation-from-inverse-wishart-correlations"></a>
</h3>
<p>An example of this simulation is below:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Creating covariance matrix</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">8</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, <span class="fl">8</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">tMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">tcrossprod</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="va">tmp</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">8</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">tMat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">$</span><span class="va">theta</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">mod2</span>, <span class="va">ev</span>, nSub<span class="op">=</span><span class="fl">100</span>, thetaMat<span class="op">=</span><span class="va">tMat</span>, nStud<span class="op">=</span><span class="fl">10</span>,</span>
<span>                dfSub<span class="op">=</span><span class="fl">10</span>, dfObs<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span><span class="va">sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="st">"sim"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> in order to put confidence bands around the intervals, you need at least 2500 simulations</span></span>
<span><span class="co">#&gt; summarizing data...done</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></code></pre></div>
<p><img src="rxode2-sim-var_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>If you wish you can see what <code>omega</code> and
<code>sigma</code> was used for each virtual study by accessing them in
the solved data object with <code>$omega.list</code> and
<code>$sigma.list</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">omegaList</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;           eta.Cl</span></span>
<span><span class="co">#&gt; eta.Cl 0.1676778</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;           eta.Cl</span></span>
<span><span class="co">#&gt; eta.Cl 0.2917085</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;           eta.Cl</span></span>
<span><span class="co">#&gt; eta.Cl 0.1776813</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt;           eta.Cl</span></span>
<span><span class="co">#&gt; eta.Cl 0.1578682</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt;           eta.Cl</span></span>
<span><span class="co">#&gt; eta.Cl 0.1845614</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]</span></span>
<span><span class="co">#&gt;           eta.Cl</span></span>
<span><span class="co">#&gt; eta.Cl 0.3282268</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">sigmaList</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;            rxerr.eff   rxerr.C2</span></span>
<span><span class="co">#&gt; rxerr.eff 1.12416983 0.04197039</span></span>
<span><span class="co">#&gt; rxerr.C2  0.04197039 0.97293971</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;             rxerr.eff    rxerr.C2</span></span>
<span><span class="co">#&gt; rxerr.eff  0.84311199 -0.06277998</span></span>
<span><span class="co">#&gt; rxerr.C2  -0.06277998  1.22140938</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;           rxerr.eff  rxerr.C2</span></span>
<span><span class="co">#&gt; rxerr.eff 0.9834771 0.1060251</span></span>
<span><span class="co">#&gt; rxerr.C2  0.1060251 1.0024751</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt;            rxerr.eff   rxerr.C2</span></span>
<span><span class="co">#&gt; rxerr.eff 1.25556975 0.07690868</span></span>
<span><span class="co">#&gt; rxerr.C2  0.07690868 0.90991261</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt;           rxerr.eff  rxerr.C2</span></span>
<span><span class="co">#&gt; rxerr.eff  1.116261 -0.184748</span></span>
<span><span class="co">#&gt; rxerr.C2  -0.184748  1.320288</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]</span></span>
<span><span class="co">#&gt;            rxerr.eff   rxerr.C2</span></span>
<span><span class="co">#&gt; rxerr.eff 0.93539238 0.07270049</span></span>
<span><span class="co">#&gt; rxerr.C2  0.07270049 0.98648424</span></span></code></pre></div>
<p>You can also see the parameter realizations from the
<code>$params</code> data frame.</p>
</div>
<div class="section level3">
<h3 id="simulate-using-variancestandard-deviation-standard-errors">Simulate using variance/standard deviation standard errors<a class="anchor" aria-label="anchor" href="#simulate-using-variancestandard-deviation-standard-errors"></a>
</h3>
<p>Lets assume we wish to simulate from <a href="https://github.com/UUPharmacometrics/xpose/blob/master/inst/extdata/run001.lst" class="external-link">the
nonmem run included in xpose</a></p>
<p>First we setup the model; Since we are taking this from nonmem and
would like to use the more free-form style from the classic
<code>rxode2</code> model we start from the classic model:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rx1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxode2.html">rxode2</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">cl</span> <span class="op">&lt;-</span> <span class="va">tcl</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">crcl.cl</span><span class="op">*</span><span class="op">(</span><span class="va">CLCR</span><span class="op">-</span><span class="fl">65</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta.cl</span><span class="op">)</span></span>
<span>  <span class="va">v</span> <span class="op">&lt;-</span> <span class="va">tv</span> <span class="op">*</span> <span class="va">WT</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta.v</span><span class="op">)</span></span>
<span>  <span class="va">ka</span> <span class="op">&lt;-</span> <span class="va">tka</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta.ka</span><span class="op">)</span></span>
<span>  <span class="va">ipred</span> <span class="op">&lt;-</span> <span class="fu">linCmt</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">obs</span> <span class="op">&lt;-</span> <span class="va">ipred</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">prop.sd</span><span class="op">)</span> <span class="op">+</span> <span class="va">add.sd</span> </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0’</span></span></code></pre></div>
<p>Next we input the estimated parameters:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>tcl<span class="op">=</span><span class="fl">2.63E+01</span>, tv<span class="op">=</span><span class="fl">1.35E+00</span>, tka<span class="op">=</span><span class="fl">4.20E+00</span>, tlag<span class="op">=</span><span class="fl">2.08E-01</span>,</span>
<span>           prop.sd<span class="op">=</span><span class="fl">2.05E-01</span>, add.sd<span class="op">=</span><span class="fl">1.06E-02</span>, crcl.cl<span class="op">=</span><span class="fl">7.17E-03</span>,</span>
<span>           <span class="co">## Note that since we are using the separation strategy the ETA variances are here too</span></span>
<span>           eta.cl<span class="op">=</span><span class="fl">7.30E-02</span>,  eta.v<span class="op">=</span><span class="fl">3.80E-02</span>, eta.ka<span class="op">=</span><span class="fl">1.91E+00</span><span class="op">)</span></span></code></pre></div>
<p>And also their covariances; To me, the easiest way to create a named
covariance matrix is to use <code><a href="https://nlmixr2.github.io/lotri/reference/lotri.html" class="external-link">lotri()</a></code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thetaMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/lotri/reference/lotri.html" class="external-link">lotri</a></span><span class="op">(</span></span>
<span>    <span class="va">tcl</span> <span class="op">+</span> <span class="va">tv</span> <span class="op">+</span> <span class="va">tka</span> <span class="op">+</span> <span class="va">tlag</span> <span class="op">+</span> <span class="va">prop.sd</span> <span class="op">+</span> <span class="va">add.sd</span> <span class="op">+</span> <span class="va">crcl.cl</span> <span class="op">+</span> <span class="va">eta.cl</span> <span class="op">+</span> <span class="va">eta.v</span> <span class="op">+</span> <span class="va">eta.ka</span> <span class="op">~</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7.95E-01</span>,</span>
<span>          <span class="fl">2.05E-02</span>, <span class="fl">1.92E-03</span>,</span>
<span>          <span class="fl">7.22E-02</span>, <span class="op">-</span><span class="fl">8.30E-03</span>, <span class="fl">6.55E-01</span>,</span>
<span>          <span class="op">-</span><span class="fl">3.45E-03</span>, <span class="op">-</span><span class="fl">6.42E-05</span>, <span class="fl">3.22E-03</span>, <span class="fl">2.47E-04</span>,</span>
<span>          <span class="fl">8.71E-04</span>, <span class="fl">2.53E-04</span>, <span class="op">-</span><span class="fl">4.71E-03</span>, <span class="op">-</span><span class="fl">5.79E-05</span>, <span class="fl">5.04E-04</span>,</span>
<span>          <span class="fl">6.30E-04</span>, <span class="op">-</span><span class="fl">3.17E-06</span>, <span class="op">-</span><span class="fl">6.52E-04</span>, <span class="op">-</span><span class="fl">1.53E-05</span>, <span class="op">-</span><span class="fl">3.14E-05</span>, <span class="fl">1.34E-05</span>,</span>
<span>          <span class="op">-</span><span class="fl">3.30E-04</span>, <span class="fl">5.46E-06</span>, <span class="op">-</span><span class="fl">3.15E-04</span>, <span class="fl">2.46E-06</span>, <span class="fl">3.15E-06</span>, <span class="op">-</span><span class="fl">1.58E-06</span>, <span class="fl">2.88E-06</span>,</span>
<span>          <span class="op">-</span><span class="fl">1.29E-03</span>, <span class="op">-</span><span class="fl">7.97E-05</span>, <span class="fl">1.68E-03</span>, <span class="op">-</span><span class="fl">2.75E-05</span>, <span class="op">-</span><span class="fl">8.26E-05</span>, <span class="fl">1.13E-05</span>, <span class="op">-</span><span class="fl">1.66E-06</span>, <span class="fl">1.58E-04</span>,</span>
<span>          <span class="op">-</span><span class="fl">1.23E-03</span>, <span class="op">-</span><span class="fl">1.27E-05</span>, <span class="op">-</span><span class="fl">1.33E-03</span>, <span class="op">-</span><span class="fl">1.47E-05</span>, <span class="op">-</span><span class="fl">1.03E-04</span>, <span class="fl">1.02E-05</span>, <span class="fl">1.67E-06</span>, <span class="fl">6.68E-05</span>, <span class="fl">1.56E-04</span>,</span>
<span>          <span class="fl">7.69E-02</span>, <span class="op">-</span><span class="fl">7.23E-03</span>, <span class="fl">3.74E-01</span>, <span class="fl">1.79E-03</span>, <span class="op">-</span><span class="fl">2.85E-03</span>, <span class="fl">1.18E-05</span>, <span class="op">-</span><span class="fl">2.54E-04</span>, <span class="fl">1.61E-03</span>, <span class="op">-</span><span class="fl">9.03E-04</span>, <span class="fl">3.12E-01</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">evw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>amount.units<span class="op">=</span><span class="st">"mg"</span>, time.units<span class="op">=</span><span class="st">"hours"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>amt<span class="op">=</span><span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co">## For this problem we will simulate with sampling windows</span></span>
<span>    <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>id<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## From the run we know that:</span></span>
<span><span class="co">##   total number of observations is: 476</span></span>
<span><span class="co">##    Total number of individuals:     74</span></span>
<span><span class="va">sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">rx1</span>, <span class="va">theta</span>, <span class="va">evw</span>,  nSub<span class="op">=</span><span class="fl">100</span>, nStud<span class="op">=</span><span class="fl">10</span>,</span>
<span>                thetaMat<span class="op">=</span><span class="va">thetaMat</span>,</span>
<span>                <span class="co">## Match boundaries of problem</span></span>
<span>                thetaLower<span class="op">=</span><span class="fl">0</span>, </span>
<span>                sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"prop.sd"</span>, <span class="st">"add.sd"</span><span class="op">)</span>, <span class="co">## Sigmas are standard deviations</span></span>
<span>                sigmaXform<span class="op">=</span><span class="st">"identity"</span>, <span class="co"># default sigma xform="identity"</span></span>
<span>                omega<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"eta.cl"</span>, <span class="st">"eta.v"</span>, <span class="st">"eta.ka"</span><span class="op">)</span>, <span class="co">## etas are variances</span></span>
<span>                omegaXform<span class="op">=</span><span class="st">"variance"</span>, <span class="co"># default omega xform="variance"</span></span>
<span>                iCov<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>WT<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">70</span>, <span class="fl">15</span><span class="op">)</span>, CLCR<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">65</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                dfSub<span class="op">=</span><span class="fl">74</span>, dfObs<span class="op">=</span><span class="fl">476</span><span class="op">)</span>;</span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> thetaMat has too many items, ignored: 'tlag'</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">── Solved rxode2 object ──</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">── Parameters (</span><span style="color: #0000BB; font-weight: bold;">$params</span><span style="font-weight: bold;">): ──</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10,000 × 9</span></span></span>
<span><span class="co">#&gt;    sim.id id      tcl crcl.cl  eta.cl    tv   eta.v   tka  eta.ka</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>      1 1      27.0   0.828 -<span style="color: #BB0000;">0.884</span>   1.73  0.531   5.38  0.114 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>      1 2      27.0   0.828  1.11    1.73 -<span style="color: #BB0000;">0.906</span>   5.38 -<span style="color: #BB0000;">0.738</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>      1 3      27.0   0.828 -<span style="color: #BB0000;">0.690</span>   1.73  0.280   5.38 -<span style="color: #BB0000;">0.365</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>      1 4      27.0   0.828  0.075<span style="text-decoration: underline;">1</span>  1.73 -<span style="color: #BB0000;">1.17</span>    5.38 -<span style="color: #BB0000;">0.575</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>      1 5      27.0   0.828 -<span style="color: #BB0000;">0.299</span>   1.73 -<span style="color: #BB0000;">0.121</span>   5.38 -<span style="color: #BB0000;">0.601</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>      1 6      27.0   0.828 -<span style="color: #BB0000;">0.638</span>   1.73 -<span style="color: #BB0000;">0.281</span>   5.38 -<span style="color: #BB0000;">0.309</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>      1 7      27.0   0.828  1.05    1.73 -<span style="color: #BB0000;">0.049</span><span style="color: #BB0000; text-decoration: underline;">5</span>  5.38  0.567 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>      1 8      27.0   0.828 -<span style="color: #BB0000;">0.371</span>   1.73 -<span style="color: #BB0000;">0.372</span>   5.38 -<span style="color: #BB0000;">0.903</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>      1 9      27.0   0.828 -<span style="color: #BB0000;">0.206</span>   1.73  1.97    5.38  0.020<span style="text-decoration: underline;">3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>      1 10     27.0   0.828  0.754   1.73  0.166   5.38 -<span style="color: #BB0000;">1.73</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 9,990 more rows</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">── Initial Conditions (</span><span style="color: #0000BB; font-weight: bold;">$inits</span><span style="font-weight: bold;">): ──</span></span></span>
<span><span class="co">#&gt; named numeric(0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Simulation <span style="font-weight: bold;">with uncertainty</span> in:</span></span>
<span><span class="co">#&gt; • parameters (<span style="color: #0000BB; font-weight: bold;">$thetaMat</span> for changes)</span></span>
<span><span class="co">#&gt; • omega matrix (<span style="color: #0000BB; font-weight: bold;">$omegaList</span>)</span></span>
<span><span class="co">#&gt; • sigma matrix (<span style="color: #0000BB; font-weight: bold;">$sigmaList</span>)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">── First part of data (object): ──</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 50,000 × 10</span></span></span>
<span><span class="co">#&gt;   sim.id    id   time     cl     v    ka  ipred    obs    WT  CLCR</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494;">[h]</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1     1 0.015<span style="text-decoration: underline;">5</span>   50.4 183.   6.03 0.048<span style="text-decoration: underline;">7</span>  3.56   62.2  69.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      1     1 0.749    50.4 183.   6.03 0.460  -<span style="color: #BB0000;">1.59</span>   62.2  69.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      1     1 1.02     50.4 183.   6.03 0.431   1.15   62.2  69.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      1     1 3.41     50.4 183.   6.03 0.224   1.92   62.2  69.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>      1     1 7.81     50.4 183.   6.03 0.066<span style="text-decoration: underline;">6</span>  0.731  62.2  69.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>      1     2 0.083<span style="text-decoration: underline;">3</span> <span style="text-decoration: underline;">2</span>816.   24.9  2.57 0.075<span style="text-decoration: underline;">4</span> -<span style="color: #BB0000;">1.20</span>   35.7 105. </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 49,994 more rows</span></span></span>
<span><span class="co">## Notice that the simulation time-points change for the individual</span></span>
<span></span>
<span><span class="co">## If you want the same sampling time-points you can do that as well:</span></span>
<span><span class="va">evw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>amount.units<span class="op">=</span><span class="st">"mg"</span>, time.units<span class="op">=</span><span class="st">"hours"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>amt<span class="op">=</span><span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">24</span>, length.out<span class="op">=</span><span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html">et</a></span><span class="op">(</span>id<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">rx1</span>, <span class="va">theta</span>, <span class="va">evw</span>,  nSub<span class="op">=</span><span class="fl">100</span>, nStud<span class="op">=</span><span class="fl">10</span>,</span>
<span>                thetaMat<span class="op">=</span><span class="va">thetaMat</span>,</span>
<span>                <span class="co">## Match boundaries of problem</span></span>
<span>                thetaLower<span class="op">=</span><span class="fl">0</span>, </span>
<span>                sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"prop.sd"</span>, <span class="st">"add.sd"</span><span class="op">)</span>, <span class="co">## Sigmas are standard deviations</span></span>
<span>                sigmaXform<span class="op">=</span><span class="st">"identity"</span>, <span class="co"># default sigma xform="identity"</span></span>
<span>                omega<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"eta.cl"</span>, <span class="st">"eta.v"</span>, <span class="st">"eta.ka"</span><span class="op">)</span>, <span class="co">## etas are variances</span></span>
<span>                omegaXform<span class="op">=</span><span class="st">"variance"</span>, <span class="co"># default omega xform="variance"</span></span>
<span>                iCov<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>WT<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">70</span>, <span class="fl">15</span><span class="op">)</span>, CLCR<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">65</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                dfSub<span class="op">=</span><span class="fl">74</span>, dfObs<span class="op">=</span><span class="fl">476</span>,</span>
<span>                resample<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> thetaMat has too many items, ignored: 'tlag'</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span><span class="va">sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ipred"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; summarizing data...</span></span>
<span><span class="co">#&gt; done</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></code></pre></div>
<p><img src="rxode2-sim-var_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="simulate-without-uncertainty-in-omega-or-sigma-parameters">Simulate without uncertainty in <code>omega</code> or
<code>sigma</code> parameters<a class="anchor" aria-label="anchor" href="#simulate-without-uncertainty-in-omega-or-sigma-parameters"></a>
</h3>
<p>If you do not wish to sample from the prior distributions of either
the <code>omega</code> or <code>sigma</code> matrices, you can turn off
this feature by specifying the <code>simVariability = FALSE</code>
option when solving:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">mod2</span>, <span class="va">ev</span>, nSub<span class="op">=</span><span class="fl">100</span>, thetaMat<span class="op">=</span><span class="va">tMat</span>, nStud<span class="op">=</span><span class="fl">10</span>,</span>
<span>                simVariability<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span><span class="va">sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"centr"</span>, <span class="st">"eff"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> in order to put confidence bands around the intervals, you need at least 2500 simulations</span></span>
<span><span class="co">#&gt; summarizing data...done</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></code></pre></div>
<p><img src="rxode2-sim-var_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
<p>Note since realizations of <code>omega</code> and <code>sigma</code>
were not simulated, <code>$omegaList</code> and <code>$sigmaList</code>
both return <code>NULL</code>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew L. Fidler, Melissa Hallow, Wenping Wang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
