<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rxode2">
<title>rxode2 Jacobian specification and Stiff Systems â€¢ rxode2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="rxode2 Jacobian specification and Stiff Systems">
<meta property="og:description" content="rxode2">
<meta property="og:image" content="https://nlmixr2.github.io/rxode2/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rxode2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.13.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--articles">
    <span class="fas fa fas fa-book"></span>
     
    Articles
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--articles">
    <h6 class="dropdown-header" data-toc-skip>Getting started</h6>
    <a class="dropdown-item" href="../articles/rxode2-syntax.html">rxode2 mini language syntax</a>
    <a class="dropdown-item" href="../articles/rxode2-pipeline.html">rxode2 with piping ie %&gt;%</a>
    <a class="dropdown-item" href="../articles/rxode2-speed.html">Speeding up rxode2 ODE solving</a>
    <a class="dropdown-item" href="../articles/rxode2-data-frame.html">Adaptive Data Frames with rxode2</a>
    <a class="dropdown-item" href="../articles/rxode2-plot.html">Plotting with rxode2</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Advanced Features, Model Types, Technical Details</h6>
    <a class="dropdown-item" href="../articles/rxode2-model-types.html">rxode2 model types</a>
    <a class="dropdown-item" href="../articles/rxode2-cmt.html">Chainging rxode2 compartment numbers</a>
    <a class="dropdown-item" href="../articles/rxode2-transit-compartments.html">rxode2 transit compartment models</a>
    <a class="dropdown-item" href="../articles/rxode2-shiny.html">Using Shiny with rxode2</a>
    <a class="dropdown-item" href="../articles/rxode2-covariates.html">rxode2 covariates</a>
    <a class="dropdown-item" href="../articles/rxode2-stiff.html">Stiff Systems and Jacobian specification</a>
    <a class="dropdown-item" href="../articles/rxode2-rxUse.html">Adding compiled rxode2 models to your package</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--dosing-events">
    <span class="fas fa fas fa-stethoscope"></span>
     
    Dosing/Events
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--dosing-events">
    <a class="dropdown-item" href="../articles/rxode2-datasets.html">nlmixr/rxode2 dataset overview</a>
    <a class="dropdown-item" href="../articles/rxode2-event-types.html">Supported Event Types</a>
    <a class="dropdown-item" href="../articles/rxode2-event-table.html">Easy rxode2 Event Tables</a>
    <a class="dropdown-item" href="../articles/rxode2-events-classic.html">Classic rxode2 events explained</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--simulations">
    <span class="fas fa fas fa-desktop"></span>
     
    Simulations
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--simulations">
    <a class="dropdown-item" href="../articles/rxode2-single-subject.html">Single Subject ODE solving</a>
    <a class="dropdown-item" href="../articles/rxode2-sim-var.html">Multiple Subject rxode2 Simulation</a>
    <a class="dropdown-item" href="../articles/rxode2-prior-data.html">Using Prior Data for ODE solving</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--help">
    <span class="fas fa fas fa-life-ring"></span>
     
    Help
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--help">
    <a class="dropdown-item" href="../articles/rxode2-tutorials.html">Running the interactive tutorials</a>
    <a class="external-link dropdown-item" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4728294/pdf/PSP4-5-03.pdf">2015 CPT tutorial</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/rxode2-covariates.html">Adding Circadian Rythmn (time-varying covariates)</a>
    <a class="dropdown-item" href="../articles/rxode2-wt.html">Weight Based Dosing</a>
    <a class="dropdown-item" href="../articles/rxode2-nesting.html">Simulating Multiple levels of nesting (iov, between study etc)</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changes/News</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://nlmixr2.github.io/rxode2/reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--">
    <span class="fas fa fas fa-archive"></span>
     
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--">
    <a class="dropdown-item" href="https://nlmixr2.github.io/rxode2-manual/">rxode2 User Guide</a>
    <a class="external-link dropdown-item" href="https://nlmixr2.org/">nlmixr2</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nlmixr2/rxode2">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nlmixr2/rxode2/releases">
    <span class="fa fa-download"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>rxode2 Jacobian specification and Stiff Systems</h1>
            
            <h4 data-toc-skip class="date">2023-08-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nlmixr2/rxode2/blob/HEAD/vignettes/rxode2-stiff.Rmd" class="external-link"><code>vignettes/rxode2-stiff.Rmd</code></a></small>
      <div class="d-none name"><code>rxode2-stiff.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="stiff-odes-with-jacobian-specification">Stiff ODEs with Jacobian Specification<a class="anchor" aria-label="anchor" href="#stiff-odes-with-jacobian-specification"></a>
</h2>
<p>Occasionally, you may come across a <a href="https://en.wikipedia.org/wiki/Stiff_equation" class="external-link"><strong>stiff</strong>
differential equation</a>, that is a differential equation that is
numerically unstable and small variations in parameters cause different
solutions to the ODEs. One way to tackle this is to choose a
stiff-solver, or hybrid stiff solver (like the default LSODA). Typically
this is enough. However exact Jacobian solutions may increase the
stability of the ODE. (Note the Jacobian is the derivative of the ODE
specification with respect to each variable). In rxode2 you can specify
the Jacobian with the <code>df(state)/dy(variable)=</code> statement. A
classic ODE that has stiff properties under various conditions is the <a href="http://www.ece.northwestern.edu/local-apps/matlabhelp/techdoc/math_anal/diffeq6.html" class="external-link">Van
der Pol</a> differential equations.</p>
<p>In rxode2 these can be specified by the following:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nlmixr2.github.io/rxode2/">rxode2</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## rxode2 2.0.13.9000 using 1 threads (see ?getRxThreads)</span></span>
<span><span class="co">##   no cache: create with `rxCreateCache()`</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Vtpol2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxode2.html">rxode2</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>  <span class="op">=</span> <span class="va">dy</span></span>
<span>    <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">dy</span><span class="op">)</span> <span class="op">=</span> <span class="va">mu</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">y</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="va">dy</span> <span class="op">-</span> <span class="va">y</span></span>
<span>    <span class="co">## Jacobian</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html" class="external-link">df</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">/</span><span class="fu">dy</span><span class="op">(</span><span class="va">dy</span><span class="op">)</span>  <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html" class="external-link">df</a></span><span class="op">(</span><span class="va">dy</span><span class="op">)</span><span class="op">/</span><span class="fu">dy</span><span class="op">(</span><span class="va">y</span><span class="op">)</span>  <span class="op">=</span> <span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">dy</span><span class="op">*</span><span class="va">mu</span><span class="op">*</span><span class="va">y</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html" class="external-link">df</a></span><span class="op">(</span><span class="va">dy</span><span class="op">)</span><span class="op">/</span><span class="fu">dy</span><span class="op">(</span><span class="va">dy</span><span class="op">)</span> <span class="op">=</span> <span class="va">mu</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">y</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="co">## Initial conditions</span></span>
<span>    <span class="fu">y</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="op">=</span> <span class="fl">2</span></span>
<span>    <span class="fu">dy</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="co">## mu</span></span>
<span>    <span class="va">mu</span> <span class="op">=</span> <span class="fl">1</span> <span class="co">## nonstiff; 10 moderately stiff; 1000 stiff</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## using C compiler: â€˜gcc (Ubuntu 11.3.0-1ubuntu1~22.04.1) 11.3.0â€™</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">et</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/eventTable.html">eventTable</a></span><span class="op">(</span><span class="op">)</span>;</span>
<span><span class="va">et</span><span class="op">$</span><span class="fu">add.sampling</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length.out<span class="op">=</span><span class="fl">200</span><span class="op">)</span><span class="op">)</span>;</span>
<span><span class="va">et</span><span class="op">$</span><span class="fu">add.dosing</span><span class="op">(</span><span class="fl">20</span>, start.time<span class="op">=</span><span class="fl">0</span><span class="op">)</span>;</span>
<span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="va">Vtpol2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="fu"><a href="https://rdrr.io/pkg/symengine/man/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">et</span>, method<span class="op">=</span><span class="st">"lsoda"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">-- Solved rxode2 object --</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">-- Parameters (</span><span style="color: #0000BB; font-weight: bold;">$params</span><span style="font-weight: bold;">): --</span></span></span>
<span><span class="co">## mu </span></span>
<span><span class="co">##  1 </span></span>
<span><span class="co">## <span style="font-weight: bold;">-- Initial Conditions (</span><span style="color: #0000BB; font-weight: bold;">$inits</span><span style="font-weight: bold;">): --</span></span></span>
<span><span class="co">##  y dy </span></span>
<span><span class="co">##  2  0 </span></span>
<span><span class="co">## <span style="font-weight: bold;">-- First part of data (object): --</span></span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 200 x 3</span></span></span>
<span><span class="co">##     time     y      dy</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 0       22    0     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 0.050<span style="text-decoration: underline;">3</span>  22.0 -<span style="color: #BB0000;">0.045</span><span style="color: #BB0000; text-decoration: underline;">6</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 0.101   22.0 -<span style="color: #BB0000;">0.045</span><span style="color: #BB0000; text-decoration: underline;">6</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 0.151   22.0 -<span style="color: #BB0000;">0.045</span><span style="color: #BB0000; text-decoration: underline;">6</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 0.201   22.0 -<span style="color: #BB0000;">0.045</span><span style="color: #BB0000; text-decoration: underline;">6</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> 0.251   22.0 -<span style="color: #BB0000;">0.045</span><span style="color: #BB0000; text-decoration: underline;">6</span></span></span>
<span><span class="co">## <span style="color: #949494;"># i 194 more rows</span></span></span></code></pre>
<p>While this is not stiff at mu=1, mu=1000 is a stiff system</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="va">Vtpol2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="fu"><a href="https://rdrr.io/pkg/symengine/man/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mu<span class="op">=</span><span class="fl">1000</span><span class="op">)</span>, <span class="va">et</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">-- Solved rxode2 object --</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">-- Parameters (</span><span style="color: #0000BB; font-weight: bold;">$params</span><span style="font-weight: bold;">): --</span></span></span>
<span><span class="co">##   mu </span></span>
<span><span class="co">## 1000 </span></span>
<span><span class="co">## <span style="font-weight: bold;">-- Initial Conditions (</span><span style="color: #0000BB; font-weight: bold;">$inits</span><span style="font-weight: bold;">): --</span></span></span>
<span><span class="co">##  y dy </span></span>
<span><span class="co">##  2  0 </span></span>
<span><span class="co">## <span style="font-weight: bold;">-- First part of data (object): --</span></span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 200 x 3</span></span></span>
<span><span class="co">##     time     y         dy</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 0       22    0        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 0.050<span style="text-decoration: underline;">3</span>  22.0 -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">045</span><span style="color: #BB0000;">5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 0.101   22.0 -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">045</span><span style="color: #BB0000;">5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 0.151   22.0 -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">045</span><span style="color: #BB0000;">5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 0.201   22.0 -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">045</span><span style="color: #BB0000;">5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> 0.251   22.0 -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">045</span><span style="color: #BB0000;">5</span></span></span>
<span><span class="co">## <span style="color: #949494;"># i 194 more rows</span></span></span></code></pre>
<p>While this is easy enough to do, it is a bit tedious. If you have
rxode2 setup appropriately, you can use the computer algebra system
sympy to calculate the Jacobian automatically.</p>
<p>This is done by the rxode2 option <code>calcJac</code> option:</p>
<pre><code><span><span class="va">Vtpol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxode2.html">rxode2</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>  <span class="op">=</span> <span class="va">dy</span></span>
<span>    <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">dy</span><span class="op">)</span> <span class="op">=</span> <span class="va">mu</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">y</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="va">dy</span> <span class="op">-</span> <span class="va">y</span></span>
<span>    <span class="co">## Initial conditions</span></span>
<span>    <span class="fu">y</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="op">=</span> <span class="fl">2</span></span>
<span>    <span class="fu">dy</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="co">## mu</span></span>
<span>    <span class="va">mu</span> <span class="op">=</span> <span class="fl">1</span> <span class="co">## nonstiff; 10 moderately stiff; 1000 stiff</span></span>
<span><span class="op">}</span>, calcJac<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
<p>To see the generated model, you can use <code><a href="../reference/rxCat.html">rxCat()</a></code>:</p>
<pre><code>&gt; rxCat(Vtpol)
d/dt(y)=dy;
d/dt(dy)=mu*(1-y^2)*dy-y;
y(0)=2;
dy(0)=0;
mu=1;
df(y)/dy(y)=0;
df(dy)/dy(y)=-2*dy*mu*y-1;
df(y)/dy(dy)=1;
df(dy)/dy(dy)=mu*(-Rx_pow_di(y,2)+1);
</code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matthew L. Fidler, Melissa Hallow, Wenping Wang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
